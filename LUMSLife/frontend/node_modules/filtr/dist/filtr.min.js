/**
 * filtr - MongoDB inspired array filtering
 * Copyright(c) 2012 Jake Luer <jake@alogicalparadox.com>
 * @see https://github.com/logicalparadox/filtr
 * MIT Licensed
 */

!function(a,b){typeof module!="undefined"?module.exports=b():typeof define=="function"&&typeof define.amd=="object"?define(b):this[a]=b()}("filtr",function(){function c(a,b){if(a&&b)for(var c in b)"undefined"==typeof a[c]&&(a[c]=b[c]);return a}function d(a){if(global==this)return new d(a);this.query=a,this.stack=h(a)}function e(a){var b=a.split(".").filter(Boolean);return b.map(function(a){var b=/([A-Za-z0-9]+)\[(\d+)\]$/,c=b.exec(a),d;return c&&(d={p:c[1],i:parseFloat(c[2])}),d||a})}function f(a,b){var c=b,d;for(var e=0,f=a.length;e<f;e++){var g=a[e];c?("object"==typeof g&&c[g.p]?c=c[g.p][g.i]:c=c[g],e==f-1&&(d=c)):d=undefined}return d}function g(a,b,c){var d=c;for(var e=0,f=a.length;e<f;e++){var g=a[e];"undefined"!=typeof d?e==f-1?"object"==typeof g&&d[g.p]?d[g.p][g.i]=b:d[g]=b:"object"==typeof g&&d[g.p]?d=d[g.p][g.i]:"object"==typeof g&&!d[g.p]?(d[g.p]=[],"object"==typeof a[e+1]?d[g.p][g.i]=[]:d[g.p][g.i]={},d=d[g.p][g.i]):d[g]?d=d[g]:(d[g]={},d=d[g]):e==f-1?d=b:"object"==typeof g?d=[]:d={}}}function h(a){var b=[];for(var c in a){var d={},f=a[c];c[0]=="$"?d.test=i(a):"string"==typeof f||"number"==typeof f||"boolean"==typeof f?(d.test=i({$eq:f}),d.path=e(c)):(d.test=i(f),d.path=e(c)),b.push(d)}return b}function i(a){var c=[];for(var e in a){var f=d.comparators[e],g=a[e],i=!1;if(b[e]){var j=[];i=!0;for(var k=0;k<g.length;k++){var l=g[k];if("string"==typeof l||"number"==typeof l||"boolean"==typeof l)i=!1;else var m=h(l);j.push(m)}}c.push({fn:f,params:i?j:g,traverse:i})}return c}function j(a,b){var c=!0;for(var d=0,e=b.length;d<e;d++){var g=b[d],h=g.path?f(g.path,a):a;k(h,g.test)||(c=!1)}return c}function k(a,b){var c=!0;for(var d=0;d<b.length;d++){var e=b[d],f=e.params;if(e.traverse){var g=[];for(var h=0;h<f.length;h++)g.push(j(a,f[h]));f=g}e.fn.length==1?e.fn(f)||(c=!1):e.fn(a,f)||(c=!1)}return c}if(!a)var a={};var b={$and:!0,$or:!0,$nor:!0};return a.exports=d,d.version="0.2.4",d.comparators={$gt:function(a,b){return a>b},$gte:function(a,b){return a>=b},$lt:function(a,b){return a<b},$lte:function(a,b){return a<=b},$all:function(a,b){for(var c=0;c<b.length;c++)if(!~a.indexOf(b[c]))return!1;return!0},$exists:function(a,b){return!!a==b},$mod:function(a,b){return a%b[0]==b[1]},$eq:function(a,b){return a==b},$ne:function(a,b){return a!=b},$in:function(a,b){return~b.indexOf(a)?!0:!1},$nin:function(a,b){return~b.indexOf(a)?!1:!0},$size:function(a,b){return a.length&&b?a.length==b:!1},$or:function(a){var b=!1;for(var c=0;c<a.length;c++){var d=a[c];d&&(b=!0)}return b},$nor:function(a){var b=!0;for(var c=0;c<a.length;c++){var d=a[c];d&&(b=!1)}return b},$and:function(a){var b=!0;for(var c=0;c<a.length;c++){var d=a[c];d||(b=!1)}return b}},d.getPathValue=function(a,b){var c=e(a);return f(c,b)},d.setPathValue=function(a,b,c){var d=e(a);g(d,b,c)},d.prototype.test=function(a,b){var d={type:"set",spec:"subset"},e=c(b||{},d),f=e.type=="single"?!1:[];e.type=="single"&&(a=[a]);for(var g=0,h=a.length;g<h;g++){var i=a[g],k=j(i,this.stack);if(e.type=="single")f=k;else switch(e.spec){case"boolean":f.push(k);break;case"index":k&&f.push(g);break;default:k&&f.push(i)}}return f},a.exports})